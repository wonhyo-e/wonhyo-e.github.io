<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Files Viewer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f6f8fa;
        }
        .container {
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .file-list {
            list-style: none;
            padding: 0;
        }
        .file-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e1e4e8;
            transition: background-color 0.2s;
        }
        .file-item:hover {
            background-color: #f6f8fa;
        }
        .file-icon {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        .file-name {
            flex-grow: 1;
            text-decoration: none;
            color: #0366d6;
        }
        .file-name:hover {
            text-decoration: underline;
        }
        .file-meta {
            color: #586069;
            font-size: 12px;
            margin-right: 12px;
        }
        .breadcrumb {
            padding: 10px 0;
            margin-bottom: 20px;
        }
        .breadcrumb a {
            color: #0366d6;
            text-decoration: none;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .breadcrumb span {
            color: #586069;
            margin: 0 5px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #586069;
        }
        .file-size {
            color: #586069;
            font-size: 12px;
            margin-right: 12px;
            min-width: 70px;
            text-align: right;
        }
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #0366d6;
            text-decoration: none;
            margin-bottom: 10px;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .search-box {
            width: 100%;
            padding: 8px;
            margin-bottom: 20px;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            font-size: 14px;
        }
        .excluded-notice {
            background-color: #fffbdd;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #735c0f;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Files Explorer</h1>
            <input type="text" class="search-box" placeholder="파일 검색..." id="searchInput">
        </div>
        <div class="breadcrumb" id="breadcrumb">
            <a href="#" data-path="">홈</a>
        </div>
        <div id="excludedNotice" class="excluded-notice" style="display: none;">
            다음 파일들은 제외됩니다: index.html, .git/, .github/
        </div>
        <div id="loading" class="loading">파일 목록을 불러오는 중...</div>
        <ul class="file-list" id="fileList"></ul>
    </div>

    <script>
        const EXCLUDED_FILES = ['index.html', '.git', '.github', 'CNAME'];
        
        // 파일 형식에 따른 아이콘 결정
        function getFileIcon(filename, isDirectory) {
            if (isDirectory) return '📁';
            
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                pdf: '📄',
                json: '📋',
                txt: '📝',
                md: '📑',
                zip: '📦',
                png: '🖼️',
                jpg: '🖼️',
                jpeg: '🖼️',
                gif: '🖼️',
                doc: '📘',
                docx: '📘',
                xls: '📊',
                xlsx: '📊',
                ppt: '📽️',
                pptx: '📽️',
                js: '📜',
                css: '📜',
                html: '📜'
            };
            return icons[ext] || '📄';
        }

        // 파일 크기 포맷팅
        function formatFileSize(bytes) {
            if (!bytes) return '';
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return `${(bytes / Math.pow(1024, i)).toFixed(1)} ${sizes[i]}`;
        }

        // 현재 경로의 파일 목록 가져오기
        async function fetchFiles(path = '') {
            try {
                const username = 'wonhyo-e'; // 여기에 GitHub 사용자명 입력
                const repo = 'wonhyo-e.github.io'; // 여기에 저장소 이름 입력
                const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
                
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                return data
                    .filter(item => !EXCLUDED_FILES.includes(item.name))
                    .sort((a, b) => {
                        // 디렉토리를 먼저 정렬
                        if (a.type !== b.type) {
                            return a.type === 'dir' ? -1 : 1;
                        }
                        // 그 다음 이름으로 정렬
                        return a.name.localeCompare(b.name);
                    });
            } catch (error) {
                console.error('Error fetching files:', error);
                return [];
            }
        }

        // 브레드크럼 업데이트
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = path.split('/').filter(Boolean);
            let currentPath = '';
            
            breadcrumb.innerHTML = '<a href="#" data-path="">홈</a>';
            
            parts.forEach((part, index) => {
                currentPath += `${part}/`;
                breadcrumb.innerHTML += `<span>/</span><a href="#" data-path="${currentPath}">${part}</a>`;
            });
        }

        // 파일 목록 표시
        function displayFiles(files, currentPath) {
            const fileList = document.getElementById('fileList');
            const loading = document.getElementById('loading');
            const excludedNotice = document.getElementById('excludedNotice');
            
            loading.style.display = 'none';
            excludedNotice.style.display = currentPath === '' ? 'block' : 'none';
            fileList.innerHTML = '';
            
            if (currentPath) {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <span class="file-icon">📁</span>
                    <a href="#" class="file-name" data-path="${currentPath.split('/').slice(0, -2).join('/')}">..（상위 폴더로）</a>
                `;
                fileList.appendChild(li);
            }

            files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                
                const filePath = currentPath + file.name;
                const isDirectory = file.type === 'dir';
                const fileLink = isDirectory ? '#' : file.download_url;
                
                li.innerHTML = `
                    <span class="file-icon">${getFileIcon(file.name, isDirectory)}</span>
                    <a href="${fileLink}" class="file-name" ${isDirectory ? `data-path="${filePath}/"` : 'target="_blank"'}>
                        ${file.name}
                    </a>
                    <span class="file-size">${formatFileSize(file.size)}</span>
                `;
                
                fileList.appendChild(li);
            });

            // 이벤트 리스너 추가
            document.querySelectorAll('.file-name').forEach(link => {
                link.addEventListener('click', function(e) {
                    const path = this.getAttribute('data-path');
                    if (path !== null) {
                        e.preventDefault();
                        loadPath(path);
                    }
                });
            });
        }

        // 경로 로드
        async function loadPath(path) {
            const loading = document.getElementById('loading');
            const fileList = document.getElementById('fileList');
            
            loading.style.display = 'block';
            fileList.innerHTML = '';
            
            updateBreadcrumb(path);
            const files = await fetchFiles(path);
            displayFiles(files, path);
        }

        // 검색 기능 설정
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            let currentFiles = [];
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredFiles = currentFiles.filter(file => 
                    file.name.toLowerCase().includes(searchTerm)
                );
                displayFiles(filteredFiles, '');
            });
        }

        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            setupSearch();
            loadPath('');
        });
    </script>
</body>
</html>